sudo: false
dist: c7
language: ruby
cache: bundler
before_install:
- bundle -v
- rm Gemfile.lock || true
- gem update --system
- gem update bundler
- gem --version
- bundle -v
script:
- bundle exec rake $CHECK
matrix:
  fast_finish: true
  include:
  - rvm: 2.1.9
    bundler_args: "--without system_tests development"
    env: PUPPET_VERSION="~> 4.0" STRICT_VARIABLES=yes CHECK=test
  - rvm: 2.2.7
    bundler_args: "--without system_tests development"
    env: PUPPET_VERSION="~> 4.0" STRICT_VARIABLES=yes CHECK=test
  - rvm: 2.3.4
    bundler_args: "--without system_tests development"
    env: PUPPET_VERSION="~> 4.0" STRICT_VARIABLES=yes CHECK=test
  - rvm: 2.4.1
    bundler_args: "--without system_tests development"
    env: PUPPET_VERSION="~> 4.0" STRICT_VARIABLES=yes CHECK=test
  - rvm: default
    bundler_args:
    sudo: required
    services: docker
    env: BEAKER_debug=1 PUPPET_INSTALL_TYPE=agent CHECK=beaker DEPLOY_TO_FORGE=yes
branches:
  only:
  - master
  - "/^v\\d/"
notifications:
  email:
  - project@bendler-net.de
deploy:
  provider: puppetforge
  user: thbe
  password:
    secure: DNIfzKO3c6soZdIOrcMacGovJi4H4nImRcFmhrvbO6syo4Nuq2W48sYJ/RAFYvN0eiiVCPvRgUIwbJGb/D6XsvGIfH6ZXbolPnEGWby76E7Oi/SIFswDaCEd7nQNG4mPnUwXSb+rHHzg0VPGes94U6/3M/CkTavS7owgQE1bg1tp4a4SQTLNjOt9xC8LcXSJ8bbTrTivXlaxdkegUVM3FKsvzu6PeL32KAPI/THLeClbB+VcREGkoVzDx6cXGCL69cGgNTbmFeyFNWhYKKS0Oynnx0MLLBA3GC6Q8brXerXZhi58Tugq++kAaI3M18ufynrJIfR1BnwDj3l5aIgPlEf/y2dEnEX0TK01A+4E5fm1qeW47iJFNCFjAw8yPzip9iD6SLVI2Vc3ICKB9sJq4vGtdQkero6F+128J7xWUykvCc08afBvq2Wcuk1zYglJd9wkCL6RubnWHFANo9F6xlvfe+4j/DOJlmk19eGFZvKX9CDM7BpskVcP/ynKp6OYPo+CijB8har81cTUD0NMRJUm2g+WfUYl3Yw3hhm6zVZqGO+9F8jUGijbZwtS/G0yZy/zf8BgXZRcdKaY45C9FtkPHKtJhsei9yzjbGnCyQrYIB+DNSj2CKD7bJ0IbJ2ioEQYYJTJ+bBoVXDlXIH5n+lNVSlu3vMCIun7GOvPmyA=
  on:
    condition: "$DEPLOY_TO_FORGE = yes"
