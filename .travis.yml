sudo: required
dist: trusty
services: docker
language: ruby
cache: bundler
rvm: 2.3.1
bundler_args: "--without system_tests"

before_install:
- bundle -v
- rm Gemfile.lock || true
- gem update --system
- gem update bundler
- gem --version
- bundle -v

script:
- bundle exec rake $CHECK

matrix:
  fast_finish: true
  include:
  - rvm: 2.1.9
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  - rvm: default
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  - rvm: 2.4.0
    env: PUPPET_VERSION="~> 5.0" CHECK=test
  - rvm: default
    bundler_args: ""
    env: BEAKER_set=debian-7-x64 BEAKER_debug=1 PUPPET_INSTALL_TYPE=agent CHECK=beaker
  - rvm: default
    bundler_args: ""
    env: BEAKER_set=debian-8-x64 BEAKER_debug=1 PUPPET_INSTALL_TYPE=agent CHECK=beaker
  - rvm: default
    bundler_args: ""
    env: BEAKER_set=centos-7-x64 BEAKER_debug=1 PUPPET_INSTALL_TYPE=agent CHECK=beaker

branches:
  only:
  - master
  - "/^v\\d/"

notifications:
  email:
  - project@bendler-net.de

deploy:
  provider: puppetforge
  deploy:
    branch: master
  user: thbe
  password:
    secure: "SVty55kgnoMWdZxj+uI46V04GK8jlcH4wtq60W3KZtL56No7OvSMWv/pIMwcjGulwzaFgQFOzJWtCDeI+DEMCUIzs0Lypukf0qdToHtSJv9cy7ghvY+CgwDXjA8KVBg1PNmsIbiRcmPH+CqNsXKUNpTimLxUazqD25l0YZtPsP+tvzW201LiVFgk7lilSB9YmeW4KlussOktpPtY0sl3ol0kXfLAfAPfztEZ7R0aPLkLJbbRXS89FO1cfDLCqF+6H6LYhxc/TL6jwV6yg3IL1bAl13wv07jS5iIhATSQroyjpHMUGyTpd3ZBm6GRA3WP/R9eVU9dfWByqBPT1qqOegLvi3QIrQE2nciUriT+z7TeIGkn+NiIn8gvPOx13VF4DUZrGqKYBzY4T2LuCqQN57HXO2uva4h8pawKsz2vxFqbcDDokPu2XpVL6o8ol4Tq2GX3iliwSbXImRIzaypX+nGIUDtqUVNriOpTH94bM9Lkom4gG1ZCWiXe+cbxTGbOr9J7YA86/iQMCKzfnqLWvmd4Ao3SRLZStzJjFqIUQsvI3qFqlueenV+jHfpmI1BMA+WXbFY47hIbxG81KcFSSSPuuyJh+WLjYSUxGOAcIYUlOzBMuWkCvCg/OB5FugXfNST4kgyg8dTrVMlydqieSmeX9DfHRmQ1y0nj70aPeB4="
  on:
    tags: true
    all_branches: true
